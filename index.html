<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¥æŠ±æé†’åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #fce4ec 0%, #fce4ec 50%, #ffe4e1 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin-bottom: 24px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h1 {
            font-size: 28px;
            color: #333;
        }

        .heart-icon {
            font-size: 40px;
        }

        .settings-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .settings-btn:hover {
            background: #f5f5f5;
        }

        .settings-panel {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 24px;
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .settings-row {
            display: flex;
            gap: 16px;
            margin-top: 12px;
        }

        .settings-field {
            flex: 1;
        }

        .settings-field label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }

        .settings-field input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .status-text {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        .main-display {
            text-align: center;
            margin-bottom: 32px;
        }

        .hug-emoji {
            font-size: 64px;
            margin-bottom: 8px;
        }

        .today-count {
            font-size: 48px;
            font-weight: bold;
            color: #e91e63;
            margin: 8px 0;
        }

        .countdown-box {
            background: linear-gradient(135deg, #fce4ec 0%, #ffebee 100%);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .countdown-time {
            font-size: 40px;
            font-weight: bold;
            color: #c2185b;
        }

        .alert-box {
            background: #ffebee;
            border: 2px solid #ef9a9a;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 16px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .pause-box {
            background: #f5f5f5;
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .hug-button {
            background: linear-gradient(135deg, #e91e63 0%, #ec407a 100%);
            color: white;
            border: none;
            padding: 16px 48px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(233, 30, 99, 0.3);
            transition: all 0.3s;
        }

        .hug-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(233, 30, 99, 0.4);
        }

        .calendar-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .calendar-icon {
            font-size: 24px;
        }

        h2 {
            font-size: 24px;
            color: #333;
        }

        .date-picker {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 18px;
            margin-bottom: 16px;
        }

        .selected-date-count {
            background: linear-gradient(135deg, #fce4ec 0%, #ffebee 100%);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .selected-date-count .count {
            font-size: 40px;
            font-weight: bold;
            color: #e91e63;
        }

        .week-stats h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 16px;
        }

        .day-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: background 0.3s;
        }

        .day-row:hover {
            background: #f0f0f0;
        }

        .day-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .day-date {
            font-weight: 500;
            color: #333;
        }

        .day-name {
            color: #666;
            font-size: 14px;
        }

        .day-hearts {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hearts-display {
            display: flex;
            gap: 2px;
        }

        .mini-heart {
            font-size: 12px;
        }

        .day-count {
            font-weight: bold;
            color: #e91e63;
            min-width: 50px;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <div class="header-title">
                    <span class="heart-icon">â¤ï¸</span>
                    <h1>æ‹¥æŠ±æé†’åŠ©æ‰‹</h1>
                </div>
                <button class="settings-btn" onclick="toggleSettings()">
                    <span style="font-size: 24px">âš™ï¸</span>
                </button>
            </div>

            <div class="settings-panel" id="settingsPanel">
                <h3 style="margin-bottom: 12px;">å®šæ—¶è®¾ç½®</h3>
                <div class="settings-row">
                    <div class="settings-field">
                        <label>æš‚åœå¼€å§‹æ—¶é—´</label>
                        <input type="time" id="pauseStart" value="22:00" onchange="updatePauseSettings()">
                    </div>
                    <div class="settings-field">
                        <label>æš‚åœç»“æŸæ—¶é—´</label>
                        <input type="time" id="pauseEnd" value="08:00" onchange="updatePauseSettings()">
                    </div>
                </div>
                <p class="status-text" id="statusText"></p>
            </div>

            <div class="main-display">
                <div class="hug-emoji">ğŸ’•</div>
                <p style="color: #666;">ä»Šå¤©å·²æ‹¥æŠ±</p>
                <div class="today-count" id="todayCount">0</div>
                <p style="color: #666;">æ¬¡</p>

                <div id="countdownBox" class="countdown-box" style="display: none;">
                    <p style="color: #666; margin-bottom: 8px;">â° ä¸‹æ¬¡æ‹¥æŠ±å€’è®¡æ—¶</p>
                    <div class="countdown-time" id="countdownTime">60:00</div>
                </div>

                <div id="alertBox" class="alert-box" style="display: none;">
                    <p style="font-size: 20px; font-weight: bold; color: #c2185b;">ğŸ’• è¯¥å»æ‹¥æŠ±ä½ çš„å¦»å­å•¦ï¼ğŸ’•</p>
                </div>

                <div id="pauseBox" class="pause-box" style="display: none;">
                    <p style="color: #666;">â¸ï¸ æé†’å·²æš‚åœï¼ˆä¼‘æ¯æ—¶é—´ï¼‰</p>
                </div>

                <button class="hug-button" onclick="recordHug()">
                    âœ“ æ‹¥æŠ±æ‰“å¡
                </button>
            </div>
        </div>

        <div class="card">
            <div class="calendar-header">
                <span class="calendar-icon">ğŸ“…</span>
                <h2>æ‹¥æŠ±æ—¥å†</h2>
            </div>

            <input type="date" class="date-picker" id="datePicker" onchange="updateSelectedDate()">

            <div class="selected-date-count">
                <p style="color: #666; margin-bottom: 8px;">é€‰ä¸­æ—¥æœŸæ‹¥æŠ±æ¬¡æ•°</p>
                <div class="count" id="selectedDateCount">0 æ¬¡</div>
            </div>

            <div class="week-stats">
                <h3>æœ€è¿‘7å¤©ç»Ÿè®¡</h3>
                <div id="weekStats"></div>
            </div>
        </div>
    </div>

    <script>
        var hugs = [];
        var timeRemaining = null;
        var isActive = true;
        var countdownInterval = null;
        var pauseStart = '22:00';
        var pauseEnd = '08:00';

        function init() {
            loadData();
            updatePauseSettings();
            updateDisplay();
            checkPauseTime();
            setInterval(checkPauseTime, 60000);
            
            var today = new Date().toISOString().split('T')[0];
            document.getElementById('datePicker').value = today;
            updateSelectedDate();
            
            requestNotificationPermission();
        }

        function loadData() {
            var stored = localStorage.getItem('hugs');
            if (stored) {
                hugs = JSON.parse(stored);
                
                if (hugs.length > 0) {
                    var lastHug = hugs[hugs.length - 1];
                    var timeSinceLastHug = Date.now() - lastHug.timestamp;
                    var remaining = 3600000 - timeSinceLastHug;
                    if (remaining > 0) {
                        timeRemaining = remaining;
                        startCountdown();
                    }
                }
            }
        }

        function saveData() {
            localStorage.setItem('hugs', JSON.stringify(hugs));
        }

        function toggleSettings() {
            var panel = document.getElementById('settingsPanel');
            panel.classList.toggle('active');
        }

        function updatePauseSettings() {
            pauseStart = document.getElementById('pauseStart').value;
            pauseEnd = document.getElementById('pauseEnd').value;
            localStorage.setItem('pauseStart', pauseStart);
            localStorage.setItem('pauseEnd', pauseEnd);
            checkPauseTime();
        }

        function checkPauseTime() {
            var now = new Date();
            var currentTime = now.getHours() * 60 + now.getMinutes();
            var startParts = pauseStart.split(':');
            var endParts = pauseEnd.split(':');
            var startH = parseInt(startParts[0]);
            var startM = parseInt(startParts[1]);
            var endH = parseInt(endParts[0]);
            var endM = parseInt(endParts[1]);
            var startMinutes = startH * 60 + startM;
            var endMinutes = endH * 60 + endM;

            if (startMinutes < endMinutes) {
                isActive = currentTime < startMinutes || currentTime >= endMinutes;
            } else {
                isActive = currentTime >= endMinutes && currentTime < startMinutes;
            }

            updateStatusText();
            updateDisplay();
        }

        function updateStatusText() {
            var statusText = document.getElementById('statusText');
            statusText.textContent = isActive ? 'å½“å‰çŠ¶æ€ï¼šâœ… æé†’å·²å¯ç”¨' : 'å½“å‰çŠ¶æ€ï¼šâ¸ï¸ æé†’å·²æš‚åœ';
        }

        function recordHug() {
            var newHug = {
                id: Date.now(),
                timestamp: Date.now(),
                date: new Date().toISOString().split('T')[0]
            };
            hugs.push(newHug);
            saveData();
            
            timeRemaining = 3600000;
            startCountdown();
            updateDisplay();
            requestNotificationPermission();
        }

        function startCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(function() {
                if (isActive && timeRemaining > 0) {
                    timeRemaining -= 1000;
                    updateDisplay();
                    
                    if (timeRemaining <= 0) {
                        timeRemaining = 0;
                        clearInterval(countdownInterval);
                        sendNotification();
                        updateDisplay();
                    }
                }
            }, 1000);
        }

        function formatTime(ms) {
            var minutes = Math.floor(ms / 60000);
            var seconds = Math.floor((ms % 60000) / 1000);
            return minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
        }

        function updateDisplay() {
            var today = new Date().toISOString().split('T')[0];
            var todayHugs = hugs.filter(function(h) { return h.date === today; });
            document.getElementById('todayCount').textContent = todayHugs.length;

            var countdownBox = document.getElementById('countdownBox');
            var alertBox = document.getElementById('alertBox');
            var pauseBox = document.getElementById('pauseBox');

            countdownBox.style.display = 'none';
            alertBox.style.display = 'none';
            pauseBox.style.display = 'none';

            if (!isActive) {
                pauseBox.style.display = 'block';
            } else if (timeRemaining !== null && timeRemaining > 0) {
                countdownBox.style.display = 'block';
                document.getElementById('countdownTime').textContent = formatTime(timeRemaining);
            } else if (timeRemaining === 0) {
                alertBox.style.display = 'block';
            }

            updateWeekStats();
        }

        function updateSelectedDate() {
            var selectedDate = document.getElementById('datePicker').value;
            var count = hugs.filter(function(h) { return h.date === selectedDate; }).length;
            document.getElementById('selectedDateCount').textContent = count + ' æ¬¡';
        }

        function updateWeekStats() {
            var weekStats = document.getElementById('weekStats');
            var days = [];
            
            for (var i = 6; i >= 0; i--) {
                var date = new Date();
                date.setDate(date.getDate() - i);
                days.push(date.toISOString().split('T')[0]);
            }

            var dayNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            
            var html = '';
            for (var j = 0; j < days.length; j++) {
                var date = days[j];
                var count = hugs.filter(function(h) { return h.date === date; }).length;
                var dateObj = new Date(date);
                var dayName = dayNames[dateObj.getDay()];
                var hearts = '';
                for (var k = 0; k < Math.min(count, 10); k++) {
                    hearts += 'â¤ï¸';
                }
                
                html += '<div class="day-row">' +
                    '<div class="day-info">' +
                    '<span class="day-date">' + date + '</span>' +
                    '<span class="day-name">' + dayName + '</span>' +
                    '</div>' +
                    '<div class="day-hearts">' +
                    '<span class="hearts-display">' + hearts + '</span>' +
                    '<span class="day-count">' + count + ' æ¬¡</span>' +
                    '</div>' +
                    '</div>';
            }
            weekStats.innerHTML = html;
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function sendNotification() {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('ğŸ’• æ‹¥æŠ±æ—¶é—´åˆ°äº†ï¼', {
                    body: 'è¯¥å»æ‹¥æŠ±ä½ çš„å¦»å­å•¦ï½',
                    icon: 'ğŸ’•'
                });
            }
        }

        window.onload = init;
    </script>
</body>
</html>
